Date: 2026-01-20

Important Links

* MatrixOS ‚Äì the swarm agents and supporting files (install to server or use Phoenix‚Äôs railgun):
  [https://github.com/matrixswarm/matrixos](https://github.com/matrixswarm/matrixos)

* Phoenix ‚Äì the swarm‚Äôs GUI:
  [https://github.com/matrixswarm/phoenix](https://github.com/matrixswarm/phoenix)

‚ö†Ô∏è It‚Äôs advised to update Phoenix and MatrixOS simultaneously.

---

COMMIT: MatrixSwarm ‚Äì Uptime_Sentinel ‚Äì Flap-Guard Edition

This commit hardens **Uptime Sentinel** against false positives, and unstable recovery conditions by introducing **normalized text comparison** and **multi-cycle recovery confirmation**.

---

## Technical Overview

### Core Problem Addressed

Previously, content-based uptime checks compared **raw HTML** directly against expected strings.
This caused alert loops when pages contained:

* HTML comments
* Escaped entities (`&quot;`, `&amp;`)
* Smart quotes
* Whitespace
* Partial or transient renders

In addition, **single-cycle recovery** allowed endpoints to oscillate between DOWN and RECOVERY, creating alert spam and false confidence.

---

## Key Changes Introduced

### 1. Text Normalization Layer (Ingest-Time)

All page content and expected strings are now normalized **before evaluation**.

Normalization includes:

* HTML entity decoding
* HTML comment stripping
* Smart quote normalization
* Whitespace collapsing
* Safe trimming

This ensures comparisons are **semantic**, not brittle.

---

### 2. Deterministic Content Evaluation

Expected-text checks now operate on **clean, normalized bodies** instead of raw HTML.

This prevents mismatches caused by markup noise, encoding artifacts, or inline comments.

---

### 3. Recovery Hysteresis (Flap Suppression)

Recovery alerts are no longer emitted on the first successful check.

A target must now pass **multiple consecutive healthy evaluations** before recovery is declared.

Behavior:

* DOWN alerts remain immediate
* RECOVERY requires confirmed stability
* Content flicker no longer triggers oscillation

This introduces **state inertia**, eliminating alert loops without masking real outages.

---

## Runtime Logic Summary

### Failure Detection

* HTTP failure OR
* Expected text missing after normalization

Triggers immediate DOWN state.

---

### Recovery Detection

* Endpoint must pass N consecutive checks (default: 3)
* Only then is RECOVERY emitted
* Recovery counters reset on any failure

---

## State Tracking Additions

Per-endpoint runtime tracking now includes:

* Last success state
* Last alert timestamp
* Consecutive recovery hit counter

All tracking is memory-local and requires no persistence or restart.

---

## Design Goals Achieved

* Alert Stability: Eliminates DOWN/UP oscillation caused by content flicker.
* Deterministic Matching: Normalized text comparison removes HTML noise sensitivity.
* Fast Failure, Slow Recovery: Industry-grade uptime semantics.
* Backward Compatible: No config changes required.
* Zero External Dependencies: Pure Python, lightweight, safe.

---

## Example Log Flow

[UPTIME] [https://example.com](https://example.com) ‚Üí 200 OK
[UPTIME] Expected text missing ‚Üí MISMATCH
[UPTIME][ALERT] üîª DOWN: content mismatch

‚Ä¶ page stabilizes ‚Ä¶

[UPTIME] Recovery check 1/3 passed
[UPTIME] Recovery check 2/3 passed
[UPTIME] Recovery check 3/3 passed
[UPTIME][ALERT] üî∫ RECOVERY: endpoint stable

---

## Future Objectives

* Advisory vs Critical content checks
* Multiple OR / AND expected tokens
* Static marker verification support
* Hash-based region validation
* Optional JS-aware probes via headless agents

---

Commit signed by:
Commander & ChatGPT ‚Äî Victory Always Division
‚ÄúTruth over noise. Stability over optimism.‚Äù

---
