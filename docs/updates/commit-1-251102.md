## MatrixOS Core: refactored email_send agent for robust TLS and diagnostic logging

### Summary
Refactored the email_send agent to improve reliability, security, and observability during SMTP operations.
This update brings the agent in line with current Phoenix cockpit compatibility and modern email provider requirements.

### Key Changes

- TLS Initialization:
  Replaced ad-hoc SSL usage with a fully verified ssl.create_default_context(ssl.Purpose.SERVER_AUTH) block.
  Enforces hostname checking and certificate verification by default.

- Structured Logging:
  Added progress logs for every major step:
  [EMAIL][CONNECT], [EMAIL][SEND], [EMAIL][TLS][AUTH], [EMAIL][TLS][CERT].
  Makes debugging SMTP sessions transparent in both cockpit and console logs.

- Failure Recovery:
  Hardened against:
  - smtplib.SMTPAuthenticationError → logs clean credential failures.
  - ssl.SSLError → detailed certificate or handshake errors.
  - Any generic exceptions → captured with block-level traceback.

- Message Dispatch Flow:

  Connect → Login → Send → Disconnect → Log success/failure
  Each stage now clearly logged and recoverable.

- Command Behavior Alignment:
  cmd_send_email now unwraps nested payloads properly (content["payload"]) to match the cockpit’s service routing.
  Prevents packet listener crashes during malformed or nested command packets.

- Security

 - Default TLS verification enabled.
 - Falls back to unverified context only if CA store is missing.
 - Compatible with modern mail services (Gmail, Outlook, custom SMTP).

- Sentinel

 - Cleaned up Sentinel from spamming the logs. Only reports on status every 10 minutes.

### Future Work

- Integrate inbound IMAP polling for alert confirmation.

- Extend with cmd_send_bulk for multi-recipient event notifications.

- Link to Phoenix GUI’s email panel for live queue management.

### Summary Quote

“Refactored for resilience — Phoenix talks, Matrix delivers.”
— The Generals, commit log 11.02.25